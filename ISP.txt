hostnamectl set-hostname isp.au-team.irpo:; exec bash

mkdir /etc/net/ifaces/ens19 /etc/net/ifaces/ens20

echo "172.16.1.1/28" > /etc/net/ifaces/ens19/ipv4address

echo "172.16.2.1/28" > /etc/net/ifaces/ens20/ipv4address

cat > /etc/net/ifaces/ens19/options << EOF 
BOOTPROTO=static
TYPE=eth
NM_CONTROLLED=no
DISABLED=no
CONFIG_WIRELESS=no
SYSTEMD_BOOTPROTO=static
CONFIG_IPV4=yes
SYSTEMD_CONTROLLED=no
EOF

cat > /etc/net/ifaces/ens20/options << EOF 
BOOTPROTO=static
TYPE=eth
NM_CONTROLLED=no
DISABLED=no
CONFIG_WIRELESS=no
SYSTEMD_BOOTPROTO=static
CONFIG_IPV4=yes
SYSTEMD_CONTROLLED=no
EOF

systemctl restart network

sed -i 's/net.ipv4.ip_forward = 0/net.ipv4.ip_forward = 1/' /etc/net/sysctl.conf

apt-get update && apt-get install -y iptables tzdata

iptables -t nat -A POSTROUTING -o ens18 -j MASQUERADE -s 172.16.1.0/28

iptables -t nat -A POSTROUTING -o ens18 -j MASQUERADE -s 172.16.2.0/28

iptables -A FORWARD -i ens19 -o ens18 -s 172.16.1.0/28 -j ACCEPT

iptables -A FORWARD -i ens20 -o ens18 -s 172.16.2.0/28 -j ACCEPT

iptables-save -f /etc/sysconfig/iptables

sysctl -p /etc/sysctl.conf

systemctl enable --now iptables

systemctl restart iptables

timedatectl set-timezone Asia/Yekaterinburg
